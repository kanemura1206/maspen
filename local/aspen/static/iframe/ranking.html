<html>
  <head>
    <meta http-equiv="Refresh" content="10">
    <link rel="stylesheet" href="http://konoha.ubicg.ynu.ac.jp/maspen/local/aspen/static/css/bootstrap.min.css">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type='text/javascript' src='https://www.google.com/jsapi'></script>
    <script type='text/javascript'>
      google.load('visualization', '1', {packages:['table']});
      google.setOnLoadCallback(drawTable);

      function getUrlVars(){
         var vars = [], hash;
         var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
         for(var i = 0; i < hashes.length; i++){
            hash = hashes[i].split('=');
            vars.push(hash[0]);
            vars[hash[0]] = hash[1];
         }
         return vars;
      }


      function drawTable() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Name');
        data.addColumn('number', 'Code');
        data.addColumn('number', 'Error');

        var jsonData = $.ajax({
           url: "http://konoha.ubicg.ynu.ac.jp/maspen/webservice/rest/server.php",
           dataType: "json",
           async: false,
           data: {
                wstoken: "2d1a05efd36f0751a6a9fa7c6e3179e7",
                wsfunction: "local_exfunctions_get_run_runking",
                moodlewsrestformat: "json",
                id: getUrlVars()["id"],
           }
         }).responseText;
         var obj = jQuery.parseJSON(jsonData);
	 var array = [];
	 var i = 0;
	 while(i < obj.length){
	    var num = array.push([obj[i].username, obj[i].code, obj[i].error]) - 1;
	    if(obj[i].userid == getUrlVars()["userid"]){
		var row = num;
	    }
	    i++;
	 }

        data.addRows(array);
	data.setProperty(row, 0, 'style', 'background-color: yellow;');
	data.setProperty(row, 1, 'style', 'background-color: yellow;');
	data.setProperty(row, 2, 'style', 'background-color: yellow;');
        var table = new google.visualization.Table(document.getElementById('table_div'));
        table.draw(data, {showRowNumber: true, allowHtml: true});
      }
    </script>
  </head>

  <body>
    <h3>Ranking</h3>
    <div id='table_div'></div>
  </body>
</html>
